# 中医医生推荐系统设计文档

## 1. 系统概述

本系统基于患者的诊断报告，结合医生的专业背景、临床经验和患者评价，提供智能化的中医医生推荐服务。

## 2. 数据模型

### 2.1 医生模型 (Doctor)

| 字段 | 类型 | 说明 |
|------|------|------|
| name | 字符串 | 医生姓名 |
| title | 字符串 | 职称（主任医师/副主任医师/主治医师） |
| hospital | 字符串 | 所在医院 |
| department | 字符串 | 科室 |
| specialty | 字符串 | 专长描述 |
| tcm_patterns | 字符串 | 擅长的证型，以逗号分隔 |
| years_of_experience | 整数 | 从医年限 |
| rating | 浮点数 | 评分（1-5分） |
| patients_count | 整数 | 累计接诊量 |

## 3. 推荐算法

### 3.1 评分权重

| 评分项 | 权重 | 说明 |
|--------|------|------|
| 证型匹配 | 0.4 | 医生擅长证型与患者证型的匹配程度 |
| 职称 | 0.3 | 医生职称等级 |
| 综合评价 | 0.3 | 患者评分和接诊量的综合得分 |

### 3.2 职称权重

| 职称 | 权重 |
|------|------|
| 主任医师 | 1.0 |
| 副主任医师 | 0.8 |
| 主治医师 | 0.6 |

### 3.3 评分计算公式

```
总分 = (证型匹配分数 × 0.4) + (职称权重 × 0.3) + (评分和接诊量分数 × 0.3)

其中：
评分和接诊量分数 = (评分/5 × 0.7) + (min(接诊量/5000, 1) × 0.3)
```

## 4. 推荐流程

1. **证型提取**
   - 从诊断报告中提取证型关键词
   - 对证型进行标准化处理

2. **医生筛选**
   - 获取所有在职医生信息
   - 计算每位医生的各项得分：
     - 证型匹配度
     - 职称权重
     - 评分和接诊量得分

3. **排序推荐**
   - 计算每位医生的总得分
   - 按得分降序排列
   - 生成推荐列表

## 5. API接口

### 5.1 获取医生推荐

- **接口**: `/api/doctors/recommend/`
- **方法**: POST
- **参数**: 
  ```json
  {
    "report_id": "诊断报告ID"
  }
  ```
- **返回示例**:
  ```json
  {
    "report_id": "报告ID",
    "recommendations": [
      {
        "doctor": {
          "id": "医生ID",
          "name": "医生姓名",
          "title": "职称",
          "hospital": "医院",
          "department": "科室",
          "specialty": "专长",
          "tcm_patterns": "擅长证型",
          "years_of_experience": "从医年限",
          "rating": "评分",
          "patients_count": "接诊量"
        },
        "matching_score": "匹配得分",
        "matching_reasons": ["匹配原因1", "匹配原因2"]
      }
    ]
  }
  ```

## 6. 后续优化方向

1. **算法优化**
   - 引入更多维度的匹配因素
   - 优化权重分配
   - 加入机器学习模型

2. **功能扩展**
   - 添加地理位置因素
   - 考虑医生当前工作量
   - 加入预约系统对接

3. **用户体验**
   - 提供更详细的匹配原因说明
   - 加入用户反馈机制
   - 优化推荐结果展示
